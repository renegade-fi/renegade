[package]
name = "state"
version = "0.1.0"
edition = "2024"

[features]
# Used to enable mocks from other crates in tests
mocks = ["dep:tempfile", "dep:test-helpers"]
ci = ["mocks"]

[[bench]]
name = "storage"
harness = false
required-features = ["mocks"]

[[bench]]
name = "applicator"
harness = false
required-features = ["mocks"]

[[bench]]
name = "interface"
harness = false
required-features = ["mocks"]

[[bench]]
name = "caching"
harness = false
required-features = ["mocks"]

[dependencies]

# === Replication === #
openraft = { version = "=0.9.13", features = ["serde", "storage-v2"] }

# === Storage === #
ciborium = "0.2"
flate2 = "1.0"
libmdbx = "0.3"

# === Messaging + Concurrency === #
crossbeam = { workspace = true }
futures = { workspace = true }
tokio = { workspace = true }

# === Workspace Dependencies === #
alloy-primitives = { workspace = true }
circuit-types = { workspace = true }
darkpool-types = { workspace = true, features = ["rkyv"] }
types-core = { workspace = true }
types-gossip = { workspace = true, features = ["rkyv"] }
types-tasks = { workspace = true, features = ["rkyv"] }
types-account = { workspace = true }
types-runtime = { workspace = true }
config = { workspace = true }
constants = { workspace = true }
external-api = { workspace = true, features = ["task-api"] }
gossip-api = { workspace = true }
job-types = { workspace = true }
system-bus = { workspace = true }
system-clock = { workspace = true }
test-helpers = { workspace = true, optional = true, features = ["mocks"] }
util = { workspace = true }

# === Serialization === #
rkyv = { workspace = true, features = ["unaligned"] }
serde = { workspace = true }

# === Misc === #
async-trait = { workspace = true }
itertools = "0.10"
fxhash = "0.2"
libp2p = { workspace = true }
rand = "0.8"
tempfile = { version = "3.8", optional = true }
thiserror = { workspace = true }
tracing = { workspace = true, features = ["log"] }
tracing-opentelemetry = { workspace = true }
uuid = "1.1.2"
metrics = { workspace = true }

[dev-dependencies]
criterion = { version = "0.5", features = ["async", "async_tokio"] }
eyre = "0.6"
multiaddr = "0.17"
num-bigint = "0.4"
num-traits = "0.2"
tempfile = "3.8"
rand = { workspace = true }
uuid = "1.4"
test-helpers = { workspace = true, features = ["mocks"] }
types-gossip = { workspace = true, features = ["mocks", "rkyv"] }
types-tasks = { workspace = true, features = ["mocks", "rkyv"] }
tokio-stream = "0.1"

# Silence config warnings for testing
config = { workspace = true, features = ["silent"] }
